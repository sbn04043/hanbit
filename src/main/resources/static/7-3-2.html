<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>7-3-2 bookmark</title>
</head>
<body>
<form onsubmit="return addBookmarkRequest();">
    <label>즐겨찾기 이름 : </label><input type="text" name="name">
    <label>즐겨찾기 URL : </label><input type="text" name="url">
    <input type="submit">
</form>
<button onclick="getBookmarkListRequest();">즐겨찾기 목록 가져오기</button>
<ol id="bookmark-list">
    북마크 리스트
</ol>

<script>
    function addBookmarkRequest() {
        const name = document.querySelector('input[name=name]').value;
        const url = document.querySelector('input[name=url]').value;
        const requestObject = {name: name, url: url};
        const requestJson = JSON.stringify(requestObject);

        function onReadyStateChange(event) {
            const currentAjaxRequest = event.currentTarget;
            if (currentAjaxRequest.readyState === XMLHttpRequest.DONE) {
                if (currentAjaxRequest.status === 200) {
                    alert('즐겨찾기가 완료됐습니다');
                } else {
                    console.error('request failed');
                }
            }
        }

        const ajaxRequest = new XMLHttpRequest();

        ajaxRequest.onreadystatechange = onReadyStateChange;
        ajaxRequest.open('post', '/bookmark');
        ajaxRequest.setRequestHeader('Content-Type', 'application/json');
        ajaxRequest.send(requestJson);

        return false;
    }

    function getBookmarkListRequest() {
        function onReadyStateChange(event) {
            const currentAjaxRequest = event.currentTarget;

            if (currentAjaxRequest.readyState === XMLHttpRequest.DONE) {
                if (currentAjaxRequest.status === 200) {
                    const bookmarkListDom = document.querySelector('#bookmark-list');
                    bookmarkListDom.innerHTML = '';

                    const bookmarks = JSON.parse(currentAjaxRequest.responseText);
                    bookmarks.forEach(bookmark => {
                        const liNode = document.createElement('li');
                        const textNode = document.createTextNode(bookmark.name + ' - ' + bookmark.url);
                        liNode.appendChild(textNode);
                        bookmarkListDom.appendChild(liNode);
                    });
                } else {
                    console.error('request failed');
                }
            }
        }

        const ajaxRequest = new XMLHttpRequest();

        ajaxRequest.onreadystatechange = onReadyStateChange;
        ajaxRequest.open('get', 'bookmarks');
        ajaxRequest.send();
    }

</script>
</body>
</html>






















